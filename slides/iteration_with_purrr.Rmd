---
title: "Iteration With purrr"
author: "JMG"
date: "11/3/2021"
output: powerpoint_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(patchwork)
library(latex2exp)
library(kableExtra)
```

## Learning Objectives

In this lesson, we cover the basic usage and application of "tidy" iteration using the `purrr` package. After this lesson you should:

1. Be familiar with common loop patterns.
2. Have a feel for the map family of `purrr` functions. 
3. Be aware of some statistical applications of iteration using the `purrr` package.


## References 

References for this lesson are

* [R for Data Science](https://r4ds.had.co.nz/)
* [Advanced R](https://adv-r.hadley.nz/)
* [purrr Documentation](https://purrr.tidyverse.org/)

You can find code relevant to this lesson on [my GitHub repo](https://github.com/jmgraham30/SWBmodules). 

## Prerequisites

This lesson assumes familiarity with

- Vectors, lists, data frames, and functions in R. 
- The use of [tidyverse](https://www.tidyverse.org/) packages such as [`tibble`](https://tibble.tidyverse.org/), [`ggplot2`](https://ggplot2.tidyverse.org/), and [`dplyr`](https://dplyr.tidyverse.org/). 
 
- Knowledge of basic statistical concepts such as confidence intervals and linear models is helpful but not essential.   

## Iteration 

In [R for Data Science](https://r4ds.had.co.nz/), good programming practices are stressed. For example, it is emphasized that one should never copy and paste code more than twice. 

- Loops provide one way to avoiding copying and pasting, 

- functions provide another.  

Let's review the basic programming construct known as for loops. 


## Loops 

Loops are examples of control flow statements in a program that result in iteration. 

- The basic idea of a for loop is that a specified action is repeated a predetermined number of times. 

- For example, if we have a container that holds three numbers and we want to multiply each of the three numbers by 2 then a for loop is an ideal method for doing this repetitive task.  

## Loops in R

A `for` loop in R has the general form

`for (item in vector) perform_action`

For example:

```
for (i in 1:3){
   print(2*i)
}
```

## Output From Example Loop

The `for` loop in the previous slide will output
```{r}
for (i in 1:3){
   print(2*i)
}
```


## Functional Programming

- Often, for loops are unnecessary in R because the language supports [functional programming](https://en.wikipedia.org/wiki/Functional_programming) (FP).

- FP is a paradigm that utilizes functions and function composition to develop code.

- Use of FP can lead to clean, concise code. 

- The `purrr` package enhances FP in R.  

## FP: Getting Started

A good way to get started with FP in R is via the `map` family of functions from `purrr`. 

- Here is a simple example:

```
map(1:3,function(x){2*x})
```

- This creates a list object that contains 2, 4, and 6.

## Output from Previous Slide

```{r}
map(1:3,function(x){2*x})
```

## Explanation of map

- The `map` function inputs an object such as a vector, list, or data frame together with a function, and applies the function to each component of the object. 

- `map` returns a list object. 

- There are similar functions, `ma_lgl`, `map_chr`, `map_dbl`, `map_int`, etc. that return different data types. Examine documentation with `?map` for details. 


## Example Output

- For example, 

```
map_dbl(1:3,function(x){2*x})
```

outputs

```{r}
map_dbl(1:3,function(x){2*x})
```

- This is a simple (atomic) vector instead of a list. 